## Improving small file performance in object-based storage

原文链接：[Improving small file performance in object-based storage](http://www.researchgate.net/publication/224285810_Improving_small_file_performance_in_object-based_storage)

摘要：本文提出了在对象存储系统中为了优化小文件性能所做的架构优化-服务器驱动的元数据预取和名字空间平坦化。服务器驱动的元数据预取就是，对于每个查询请求，元数据服务提供多个对象的信息，而不是一个。这样就能够使客户端在一次与元数据服务器交互之后访问许多小文件的内容，减少访问开销和元数据服务器负载。名字空间平坦化就是，将目录层次结构编码到对象ID中，就能够将名字空间的局部性转换为对象ID的相似性。这样做可以挖掘对象之间名字空间的关系，提高元数据索引的局部性，利用它们可以使用范围。对原型系统进行trace驱动的模拟和实验表明以上方法对于小文件负载有重大性能提升。

关键字：对象存储，对象ID分配算法，多对象能力，名字空间平坦化，OSD，范围操作，服务器驱动的元数据预取

![](https://github.com/luofengmacheng/translation/raw/master/pic/pic6.png)

图1：客户端直接访问。首先，客户端与元数据服务器通信，获取映射信息(比如，要访问的对象ID，对象存储在哪个存储设备上)和能力(比如，访问权限)。然后，客户端与对应的存储设备进行读写操作，为每个请求提供能力。

# 1 绪论

可扩展的存储解决方案越来越依赖于客户端直接访问，以获得高带宽。在一些场景中，直接访问通过特殊的SAN协议，在其它场景下，通过对象存储设备协议。如图1所示，客户端直接访问提供了可扩展带宽，它移除了中心服务器瓶颈，去掉出于关键路径的元数据管理。因此，这种存储架构变成了高端科学计算的标准。

但是，如果这种架构不能有效地支持更宽范围的负载，它注定只能是一种niche(利基，按照百度百科的解释，这是一个很窄的市场，而且服务也不好)架构，尽管基于对象的存储在文档管理和自动化方面的潜在额外价值。虽然直接访问系统对于大文件可以获得很高的带宽，但是，负载中常常包含对许多小文件的访问。而且，客户端直接访问在访问文件时总是需要先访问元数据服务器，再访问存储设备。对于大文件而言，一次元数据访问开销可以被多次数据访问分摊。然而，对于小文件而言，对每个文件进行一次元数据访问会加倍数据访问的开销，变成系统的瓶颈。

本文对这样的系统提出了提高小文件性能的架构优化。从高层次上来说，这种方法结合了重建丢失文件间的关系和元数据预取。当客户端访问文件的元数据时，元数据服务器提供这个文件和相关文件的映射信息和能力。得到这些信息后，客户端就能够消除大部分与元数据服务器的交互，减少元数据服务器的负载和客户端的访问开销。

对于任何预取技术来说，关键的挑战是识别文件之间的关系，以便能够预取合适的文件。现在，文件系统使用名字空间来识别文件之间的关系，组织以及预取相关的元数据和数据。但是，在基于对象的存储系统中，文件名和对象名不能直接获得这种关系。我们通过名字空间平坦化来重建它，将文件的层次目录位置编码到它的对象ID中。在对象ID中，保留名字空间的局部性可以为存储设备提供类似传统的文件名字空间的关系，在元数据结构中提供空间局部性，并使得相关文件组的表示紧凑。

本文描述了为了支持服务器驱动的元数据预取所做的系统和协议的改变。而且，高效要求获取能力(对多个对象的访问权限)和合适的客户端缓存管理。名字空间平坦化无需对接口做任何改变。

原型系统的测试表明，主要由小文件访问构成的负载可以获得很好的性能。客户端程序，比如CVS和系统编译，可以获得很高的吞吐量。元数据服务器的负载下降27%~94%，这就使得系统在面对元数据服务器的扩展问题之前可以扩展1.4~17倍。用基准测试工具对原型系统进行测试，对真实的NFS traces的分析表明基于名字空间的预取确实很有价值，可以减少元数据服务器负载。在这些traces中，5%~34%的元数据服务器交互可以通过预取机制消除。
